# 🌟 功能特性详解

## 📊 数据源对比

### 🗺️ 高德地图 API（推荐国内用户）

**优势：**

- ✅ 国内数据最准确，更新及时
- ✅ 支持中文城市名称
- ✅ 免费额度大（30 万次/月）
- ✅ 访问速度快（国内服务器）
- ✅ 包含未来天气预报
- ✅ 提供详细的风向风力信息

**返回数据示例：**

```json
{
  "province": "广东",
  "city": "深圳市",
  "temperature": "28",
  "weather": "阴",
  "windDirection": "东",
  "windPower": "≤3",
  "humidity": "80",
  "reportTime": "2025-06-11 17:00:16"
}
```

### 🌍 OpenWeatherMap API（推荐国际用户）

**优势：**

- ✅ 全球城市覆盖度高
- ✅ 数据字段丰富（气压、能见度、日出日落）
- ✅ 支持多种查询方式
- ✅ 国际标准化数据格式
- ✅ 长期稳定的服务

**返回数据示例：**

```json
{
  "city": "Beijing",
  "temperature": 25,
  "humidity": 65,
  "pressure": 1013,
  "windSpeed": 3.2,
  "visibility": 10,
  "sunrise": "05:30:15",
  "sunset": "19:45:22"
}
```

## 🏙️ 智能城市识别

### 支持的输入格式

1. **中文城市名**

   - `北京` → 110000
   - `深圳` → 440300
   - `上海` → 310000

2. **英文城市名**

   - `Beijing` → 110000
   - `Shenzhen` → 440300
   - `Shanghai` → 310000

3. **6 位城市编码**
   - `110000` → 北京
   - `440300` → 深圳
   - `310000` → 上海

### 城市编码查询工具

```bash
# 查询特定城市
npm run find-city 北京
npm run find-city Beijing
npm run find-city 440300

# 显示所有城市
npm run list-cities

# 按省份显示
npm run cities-by-province
```

## 📧 邮件模板展示

### 高德地图版本特色

- 🎨 **渐变背景**：现代化的紫色渐变设计
- ✨ **动画效果**：闪光动画增加视觉吸引力
- 📊 **数据完整**：包含省份、城市、更新时间
- 📅 **未来预报**：显示未来几天的天气趋势
- 🎯 **中文优化**：针对中文显示优化的字体和布局

### OpenWeatherMap 版本特色

- 🌐 **国际化**：标准化的国际数据格式
- 📈 **数据丰富**：包含气压、能见度等详细信息
- 🌅 **日出日落**：精确的日出日落时间
- 📱 **响应式**：适配各种邮件客户端

## 🔧 配置灵活性

### 多种触发方式

1. **定时自动发送**

   ```yaml
   schedule:
     - cron: "0 8 * * *" # 每天UTC 8点
   ```

2. **手动触发**

   - 支持自定义邮箱
   - 支持自定义城市
   - 支持选择数据源

3. **测试模式**
   - 专门的测试工作流
   - 快速验证配置

### 环境变量配置

```bash
# 数据源切换
WEATHER_PROVIDER=amap        # 或 openweather

# API密钥（至少配置一个）
AMAP_API_KEY=your_key
OPENWEATHER_API_KEY=your_key

# 邮件服务器
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your@email.com
SMTP_PASS=your_password

# 收件人（支持多个）
RECIPIENT_EMAILS=user1@email.com,user2@email.com

# 城市配置
CITY=Beijing                 # 城市名或编码
```

## 🛡️ 安全特性

### GitHub Secrets 保护

所有敏感信息都通过 GitHub Secrets 保护：

- API 密钥加密存储
- 邮箱密码安全保护
- 运行时环境隔离

### 错误处理

- ✅ 配置验证：启动前检查所有必需配置
- ✅ API 容错：网络错误自动重试机制
- ✅ 邮件容错：SMTP 连接失败处理
- ✅ 详细日志：完整的错误追踪信息

## 📊 性能优化

### 请求优化

- 🚀 **智能缓存**：避免重复 API 调用
- 🔄 **错误重试**：网络异常自动重试
- ⚡ **快速响应**：优化的网络请求配置

### 邮件优化

- 📱 **响应式设计**：适配各种邮件客户端
- 🎨 **样式内联**：确保样式正确显示
- 📸 **图片优化**：使用 emoji 减少加载时间

## 🔍 调试功能

### 详细日志

```
🚀 开始执行天气通知任务...
📡 数据提供商: 高德地图
🏙️ 支持的城市及编码:
=====================================
📍 中文城市名:
   北京: 110000
   上海: 310000
   ...
📍 获取 Beijing 的天气信息...
📧 发送天气信息到 2 个邮箱...
✅ 邮件发送成功: <message-id>
📧 收件人列表: user1@email.com, user2@email.com
🏙️ 天气城市: 北京
🌡️ 当前温度: 25°C
📊 数据提供商: 高德地图
✅ 天气通知任务执行成功！
🎉 所有收件人都已收到最新的天气信息！
```

### 错误诊断

- 🔍 **配置验证**：详细的配置检查信息
- 📡 **API 状态**：API 调用成功/失败状态
- 📧 **邮件状态**：邮件发送详细结果
- 💡 **修复建议**：针对性的问题解决方案

## 🚀 扩展能力

### 模块化设计

所有功能都作为独立模块导出，便于：

- 🔧 **二次开发**：可以基于现有代码扩展
- 🧪 **单元测试**：每个功能都可独立测试
- 📦 **复用集成**：可以集成到其他项目

### API 兼容性

- 📡 **统一接口**：不同数据源使用统一的调用接口
- 🔄 **自动适配**：根据配置自动选择合适的数据源
- 🛠️ **易扩展**：新增数据源时只需实现标准接口

## 📈 使用统计

### 免费额度对比

| 数据源         | 免费额度   | 付费方案     |
| -------------- | ---------- | ------------ |
| 高德地图       | 30 万次/月 | 超出按次付费 |
| OpenWeatherMap | 1000 次/天 | 多种付费套餐 |

### 推荐使用场景

- 🇨🇳 **国内用户**: 推荐高德地图，数据准确，中文友好
- 🌍 **国外用户**: 推荐 OpenWeatherMap，全球覆盖
- 🏢 **企业用户**: 可配置多数据源，确保服务可用性
- 👨‍💻 **开发者**: 使用本地调试功能，快速开发测试

## 💡 最佳实践

### 配置建议

1. **同时配置两个数据源**：确保服务可靠性
2. **设置合理的发送时间**：避开网络高峰期
3. **使用应用专用密码**：提高邮箱安全性
4. **定期检查 API 额度**：避免服务中断

### 使用技巧

1. **利用城市编码**：编码比城市名更稳定
2. **批量邮件发送**：一次发送给多个收件人
3. **自定义发送时间**：根据需要调整 cron 表达式
4. **监控执行日志**：及时发现和解决问题

---

> 💡 **提示**: 如需要更多功能或有问题，欢迎提交 Issue 或 Pull Request！
